default_platform(:ios)

platform :ios do
  desc "Increase version number"
  lane :bump do
    increment_build_number
  end

  desc "Submit a new build to Testflight"
  lane :alpha do
    # Run to fix CI bugs
    setup_ci(provider: 'circleci')

    # Unlock keychain to access signing certs
    unlock_keychain( # Unlock an existing keychain and add it to the keychain search list
      path: ENV["KEYCHAIN_PATH"],
      password: ENV["KEYCHAIN_PASS"]
    )

    # Compile release version of code
    build_app(scheme: "flare")

    # Upload to Testflight
    # TODO: UPLOAD!
  end

  desc "Submit a new build to App Store"
  lane :release do |options|
    # Increment VersionCode & VersionName
    increment_build_number
    increment_version_number(
      version_number: options[:version]
    )

    # Compile release version of code
    build_app(scheme: "flare")

    # Upload to Play Store (Release Channel)
    # TODO: UPLOAD!
  end
end
